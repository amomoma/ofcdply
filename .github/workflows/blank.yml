name: Download Microsoft Office (Single Archive)

on:
  workflow_dispatch:

jobs:
  download:
    runs-on: windows-latest
    timeout-minutes: 180

    steps:
      # 1️⃣ Prepare workspace
      - name: Prepare workspace
        shell: powershell
        run: |
          New-Item -ItemType Directory -Force -Path C:\OfficeSetup

      # 2️⃣ Download Office Deployment Tool
      - name: Download Office Deployment Tool
        shell: powershell
        run: |
          cd C:\OfficeSetup
          Invoke-WebRequest -Uri "https://officecdn.microsoft.com/pr/wsus/setup.exe" -OutFile setup.exe

      # 3️⃣ Create configuration.xml
      - name: Create configuration.xml
        shell: powershell
        run: |
          @"
          <Configuration>
            <Add OfficeClientEdition="64" Channel="MonthlyEnterprise">
              <Product ID="O365ProPlusRetail">
                <Language ID="en-us" />
                <ExcludeApp ID="Access" />
                <ExcludeApp ID="Publisher" />
                <ExcludeApp ID="OneNote" />
                <ExcludeApp ID="Teams" />
              </Product>
            </Add>
            <Display Level="None" AcceptEULA="TRUE" />
          </Configuration>
          "@ | Out-File -Encoding ASCII C:\OfficeSetup\configuration.xml

      # 4️⃣ Download Office files only
      - name: Download Office files
        shell: powershell
        run: |
          cd C:\OfficeSetup
          .\setup.exe /download configuration.xml

      # 5️⃣ Compress entire folder
      - name: Compress Office folder
        shell: powershell
        run: |
          Compress-Archive -Path C:\OfficeSetup\* -DestinationPath C:\OfficeSetup.zip -Force

      # 6️⃣ Upload compressed archive
      - name: Upload Office archive
        uses: actions/upload-artifact@v4
        with:
          name: Office365-Offline
          path: C:\OfficeSetup.zip
          retention-days: 90
